<section>
    <h2>3D rasters are powerful</h2>
    <h3> and you already know how to use them</h3>
    <h3 style="margin-top: 0.5em">
        Vaclav (Vashek) Petras</h3>
    <p class="title-foot">
        <a href="http://www.ncsu.edu/" title="North Carolina State University">NCSU</a>
        <a href="http://geospatial.ncsu.edu/osgeorel/" title="NCSU OSGeo Research and Education Laboratory">OSGeoREL</a>
        at
        <a href="http://geospatial.ncsu.edu/" title="Center for Geospatial Analytics">Center for Geospatial Analytics</a>
        <br>
        North Carolina State University
    </p>
    <p>
        US-IALE, Baltimore<br>
        April 9-13, 2017
    </p>
</section>


<section>
<h2></h2>
3D rasters (aka voxel models) have been used to represent and process
hyperspectral data,
describe forest and habitat properties,
analyze measured spatio-temporal data,
or explore simulation scenario space.
<ul>
    <li>
</ul>
</section>


<section>
<h2></h2>
2D and 2.5D does not explicitly represent and model 3D relationships
in fully 3D systems such as forest ecosystems.
3D rasters on the other hand, preserve the original relationships in the 3D data.
<ul>
    <li>
</ul>
</section>


<section>
<h2></h2>
The relationships in the third dimension may be different from the first two dimensions
which distinguishes 3D rasters from 2D rasters.
<ul>
    <li>
</ul>
</section>


<section>
<h2></h2>
Other than that, 3D rasters are very similar to the commonly used 2D rasters
and there are tools available to process them including Python, R, or Octave.
<ul>
    <li>
</ul>
</section>


<section>
<h2>Python</h2>
<ul>
    <li>using NumPy array
</ul>
<pre class="python" style="width: 30%;"><code>x = array([[[ 0,  1,  2],
            [ 3,  4,  5],
            [ 6,  7,  8]],
           [[ 9, 10, 11],
            [12, 13, 14],
            [15, 16, 17]],
           [[18, 19, 20],
            [21, 22, 23],
            [24, 25, 26]]])
x.sum(axis=0)
# array([[27, 30, 33],
#        [36, 39, 42],
#        [45, 48, 51]])
</code></pre>
<img src="img/logos/python.svg" class="stretch">
</section>


<section>
<h2>R</h2>
<ul>
    <li>using array
</ul>
<pre class="r" style="width: 30%;"><code>x = array(1:40, dim=c(2,4,5))
# , , 1
#
#      [,1] [,2] [,3] [,4]
# [1,]    1    3    5    7
# [2,]    2    4    6    8
#
# , , 2
# ...
x[2,3,3]
# 22
x[2,3,3] = 0
</code></pre>
<img src="img/logos/r.svg" class="stretch">
</section>


<section>
<h2>Octave</h2>
<ul>
    <li>using 3D matrix/array
</ul>
<pre class="octave" style="width: 30%;"><code>x = reshape(1:8, 2, 2, 2)
a(2,1,1) = 5
b = 3 * a
# b =
#
# ans(:,:,1) =
#
#     3    9
#    15   12
</code></pre>
<img src="img/logos/octave.svg" class="stretch">
</section>


<section>
<h2>GRASS GIS</h2>
We will demonstrate 3D raster algebra in GRASS GIS as an example of 3D raster processing
fully integrated into a general-purpose GIS and remote sensing tool.
<ul>
    <li>
        data types:
        <ul>
            <li>vectors
            <li>2D rasters
            <li>3D rasters
        </ul>
    <li>
        container types:
        <ul>
            <li>imagery groups
                <ul>
                    <li>series of 2D rasters
                </ul>
            <li>spatio-temporal datasets
                <ul>
                    <li>series of 2D rasters
                    <small>(or vectors or 3D rasters)</small>
                </ul>
        </ul>
</ul>
<br>
<img src="img/logos/grassgis.svg" class="stretch">
</section>


<section>
<h2>Moving window</h2>

<h3>2D</h3>

<pre class="bash" style="width: 50%;"><code>r.neighbors input=a output=b method=average size=5
r.colors map=b color=viridis
</code></pre>

<h3>3D</h3>

<pre class="bash" style="width: 50%;"><code>r3.neighbors input=a output=b method=average window=5,5,5
r3.colors map=b color=viridis
</code></pre>

</section>


<section>
<h2>3D raster algebra</h2>

<pre style="width: 30%;"><code>b = a + 2
</code></pre>

<pre style="width: 30%;"><code>b = if(a > 20, 1, null())
</code></pre>

<pre style="width: 30%;"><code>b = (a[0,0,-1] + a[0,0,1]) / 2
</code></pre>

</section>


<section>
<h2>Example: Terrain evolution</h2>
<img src="img/jr16animation.gif" class="left">
<img src="img/jr20animation.gif" class="right">
</section>


<section>
<h2>Example: Vegetation structure</h2>
3D vegetation structure derived from lidar point clouds
<small class="glow">
    Petras, V., D. J. Newcomb, and H. Mitasova.
    <em>Generalized 3D fragmentation index derived from lidar point clouds.</em>
    In: Open Geospatial Data, Software and Standards [in print]
</small>
<img src="img/fragmentation_paper.png" class="stretch box-glow">
</section>


<section>
    <h3>3D index of 3D raster</h3>
    <img class="stretch" src="img/raster3d.png">
</section>


<section>
    <h3>Point cloud</h3>
    <img class="stretch" src="img/points3d.png">
</section>


<section>
    <h3>Binning, moving window &amp; raster algebra</h3>

<pre class="bash" style="width: 70%;"><code># Bash
r3.in.lidar input=points.las n=count base_raster=ground -d class_filter=3,4,5
r3.neighbors input=count output=average method=average window=3,3,3
r3.mapcalc expression="buffer = if(average > 0, 1, 0)"
</code></pre>

    <img class="stretch" src="img/profile2d_presence.png">
    <img style="width: 10%;" src="img/count_legend.png">
</section>


<section>
    <h3>Fragmentation index</h3>

<pre class="python" style="width: 70%;"><code># Python
import grass.script as gs
gs.run_command("g.extension", extension="r3.forestfrag")
gs.run_command("r3.forestfrag", input="buffer", output="fragmentation")
</code></pre>

    <img class="stretch" src="img/profile2d_ff.png">
    <img style="width: 20%;" src="img/ff_legend.png">
</section>


<section>
    <h3>Profile of 3D raster</h3>
    <img class="stretch" src="img/profiles3d.png">
</section>


<section>
<h2>Example: Behavioral patterns</h2>
spatio-temporal data representing behavioral patterns of people in urban environments
<br>
<img src="img/amos_animation.gif" class="stretch">
</section>


<section>
<h2></h2>
we will look not only at the processing but also at the visualization of 3D rasters.
<ul>
    <li>
</ul>
</section>


<section>
<h2></h2>
Finally, we will show how to use
Python and
Bash scripting or
visual programming
to make the best use of 3D rasters.
<ul>
    <li>
</ul>
</section>
